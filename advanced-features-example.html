<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Survey Text LLM - é«˜çº§åŠŸèƒ½ç¤ºä¾‹</title>
    <script src="https://unpkg.com/jspsych@7.3.4"></script>
    <script src="survey-text-llm.js"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.3"></script>
    <script src="https://unpkg.com/@jspsych/plugin-survey-text@1.1.3"></script>
    <link href="https://unpkg.com/jspsych@7.3.4/css/jspsych.css" rel="stylesheet" type="text/css" />
    <link href="survey-text-llm.css" rel="stylesheet" type="text/css" />
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f5f7fa;
            margin: 0;
            padding: 20px;
        }
        .demo-header {
            text-align: center;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .demo-header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .demo-header p {
            color: #7f8c8d;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="demo-header">
        <h1>ğŸš€ Survey Text LLM é«˜çº§åŠŸèƒ½æ¼”ç¤º</h1>
        <p>å±•ç¤ºæ•°æ®æ”¶é›†ã€éšè—è¾“å…¥ã€é«˜çº§æŒ‰é’®æ§åˆ¶ç­‰åŠŸèƒ½</p>
    </div>

    <div id="jspsych-target"></div>

    <script>
        // åˆå§‹åŒ–jsPsych
        const jsPsych = initJsPsych({
            on_finish: function(data) {
                // æ˜¾ç¤ºå®éªŒç»“æœ
                const trials = data.trials;
                
                document.getElementById('jspsych-target').innerHTML = `
                    <div style="max-width: 1000px; margin: 0 auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                        <h2 style="color: #2c3e50; text-align: center; margin-bottom: 30px;">ğŸ‰ å®éªŒå®Œæˆï¼</h2>
                        
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 20px 0;">
                            <h3>ğŸ“Š æ”¶é›†åˆ°çš„æ•°æ®</h3>
                            <pre style="background: white; padding: 15px; border-radius: 6px; overflow-x: auto; font-size: 12px;">${JSON.stringify(trials, null, 2)}</pre>
                        </div>
                        
                        <div style="text-align: center; margin-top: 30px;">
                            <button onclick="location.reload()" style="background: #007bff; color: white; border: none; padding: 15px 30px; border-radius: 8px; cursor: pointer; font-size: 16px;">
                                ğŸ”„ é‡æ–°å¼€å§‹æ¼”ç¤º
                            </button>
                        </div>
                    </div>
                `;
            }
        });

        // æ•°æ®æ”¶é›†å™¨å‡½æ•° - ä»ä¹‹å‰çš„è¯•æ¬¡æ”¶é›†æ•°æ®
        function collectPreviousData() {
            const previousTrials = jsPsych.data.get().values();
            
            return {
                responses: previousTrials.map(trial => trial.response).filter(r => r),
                trials: previousTrials.length,
                last_response: previousTrials.length > 0 ? previousTrials[previousTrials.length - 1].response : null,
                custom: {
                    experiment_start_time: previousTrials.length > 0 ? previousTrials[0].time_elapsed : Date.now(),
                    total_time: previousTrials.reduce((sum, trial) => sum + (trial.rt || 0), 0)
                }
            };
        }

        // å®éªŒæµç¨‹
        const timeline = [];

        // 1. æ¬¢è¿é¡µé¢
        timeline.push({
            type: jsPsychHtmlKeyboardResponse,
            stimulus: `
                <div style="text-align: center; max-width: 700px; margin: 0 auto;">
                    <h1>ğŸ”¬ é«˜çº§åŠŸèƒ½æ¼”ç¤º</h1>
                    <p style="font-size: 18px; line-height: 1.6;">
                        æœ¬æ¼”ç¤ºå°†å±•ç¤ºSurvey Text LLMæ’ä»¶çš„å››ä¸ªé«˜çº§åŠŸèƒ½ï¼š
                    </p>
                    <div style="text-align: left; display: inline-block; margin: 30px 0;">
                        <ol style="font-size: 16px; line-height: 2;">
                            <li><strong>æ•°æ®æ”¶é›†åŠŸèƒ½ï¼š</strong>è‡ªåŠ¨æ”¶é›†ä¹‹å‰è¯•æ¬¡çš„æ•°æ®ä½œä¸ºAIä¸Šä¸‹æ–‡</li>
                            <li><strong>éšè—ç”¨æˆ·è¾“å…¥ï¼š</strong>åªæ˜¾ç¤ºAIè¾“å‡ºï¼Œä¸æ˜¾ç¤ºè¾“å…¥æ¡†</li>
                            <li><strong>è‡ªåŠ¨ç”Ÿæˆï¼š</strong>è¯•æ¬¡å¼€å§‹æ—¶è‡ªåŠ¨ç”ŸæˆAIå›å¤</li>
                            <li><strong>é«˜çº§æŒ‰é’®æ§åˆ¶ï¼š</strong>ç¡®è®¤ã€é‡æ–°ç”Ÿæˆã€ç¼–è¾‘ç­‰æŒ‰é’®</li>
                        </ol>
                    </div>
                    <p style="color: #7f8c8d;">æŒ‰ä»»æ„é”®å¼€å§‹æ¼”ç¤º</p>
                </div>
            `
        });

        // 2. åŸºç¡€æ•°æ®æ”¶é›†ï¼ˆä¸ºåç»­æ¼”ç¤ºæä¾›ä¸Šä¸‹æ–‡ï¼‰
        timeline.push({
            type: jsPsychSurveyText,
            preamble: `
                <h2>ğŸ“ ç¬¬ä¸€æ­¥ï¼šåŸºç¡€ä¿¡æ¯æ”¶é›†</h2>
                <p>è¯·å¡«å†™ä»¥ä¸‹ä¿¡æ¯ï¼Œè¿™äº›æ•°æ®å°†åœ¨åç»­çš„AIäº¤äº’ä¸­ä½œä¸ºä¸Šä¸‹æ–‡ä½¿ç”¨ï¼š</p>
            `,
            questions: [
                {prompt: "æ‚¨çš„ç ”ç©¶é¢†åŸŸæˆ–ä¸“ä¸šï¼š", name: "field", required: true},
                {prompt: "æ‚¨ç›®å‰æœ€æ„Ÿå…´è¶£çš„è¯é¢˜ï¼š", name: "interest", required: true, rows: 2},
                {prompt: "æ‚¨å¸Œæœ›ä»AIé‚£é‡Œå¾—åˆ°ä»€ä¹ˆç±»å‹çš„å»ºè®®ï¼Ÿ", name: "expectation", required: true, rows: 3}
            ],
            button_label: "ç»§ç»­åˆ°é«˜çº§åŠŸèƒ½æ¼”ç¤º"
        });

        // 3. åŠŸèƒ½1ï¼šæ•°æ®æ”¶é›†å™¨ + åŸºç¡€AIäº¤äº’
        timeline.push({
            type: jsPsychSurveyTextLLM,
            preamble: `
                <h2>ğŸ” åŠŸèƒ½1ï¼šæ•°æ®æ”¶é›†å™¨</h2>
                <div class="instruction-box">
                    <p><strong>æ¼”ç¤ºåŠŸèƒ½ï¼š</strong>ä½¿ç”¨<code>data_collector</code>å‡½æ•°è‡ªåŠ¨æ”¶é›†ä¹‹å‰è¯•æ¬¡çš„æ•°æ®ä½œä¸ºAIä¸Šä¸‹æ–‡</p>
                    <p>AIå°†æ ¹æ®æ‚¨ä¹‹å‰å¡«å†™çš„ä¿¡æ¯æ¥æä¾›ä¸ªæ€§åŒ–å›å¤ã€‚</p>
                </div>
            `,
            questions: [
                {
                    prompt: "æ ¹æ®æ‚¨ä¹‹å‰æä¾›çš„ä¿¡æ¯ï¼Œè¯·æè¿°ä¸€ä¸ªæ‚¨åœ¨è¯¥é¢†åŸŸé‡åˆ°çš„å…·ä½“æŒ‘æˆ˜ï¼š",
                    rows: 4,
                    required: true,
                    name: "challenge"
                }
            ],
            data_collector: collectPreviousData,
            base_url: "https://api.deepseek.com",
            api_key: "sk-7765bd6343924036b8bf4152cd5c3649",
            system_prompt: "æ ¹æ®ç”¨æˆ·ä¹‹å‰æä¾›çš„èƒŒæ™¯ä¿¡æ¯ï¼Œä½œä¸ºè¯¥é¢†åŸŸçš„ä¸“å®¶é¡¾é—®ï¼Œæä¾›é’ˆå¯¹æ€§çš„å»ºè®®å’Œè§£å†³æ–¹æ¡ˆã€‚",
            button_label: "ç»§ç»­ä¸‹ä¸€ä¸ªåŠŸèƒ½æ¼”ç¤º"
        });

        // 4. åŠŸèƒ½2ï¼šéšè—ç”¨æˆ·è¾“å…¥ + è‡ªåŠ¨ç”Ÿæˆ
        timeline.push({
            type: jsPsychSurveyTextLLM,
            preamble: `
                <h2>ğŸ­ åŠŸèƒ½2ï¼šéšè—è¾“å…¥ + è‡ªåŠ¨ç”Ÿæˆ</h2>
                <div class="instruction-box">
                    <p><strong>æ¼”ç¤ºåŠŸèƒ½ï¼š</strong></p>
                    <ul>
                        <li><code>hide_user_input: true</code> - éšè—ç”¨æˆ·è¾“å…¥æ¡†</li>
                        <li><code>auto_generate: true</code> - è‡ªåŠ¨ç”ŸæˆAIå›å¤</li>
                        <li><code>data_collector</code> - åŸºäºä¹‹å‰çš„æ•°æ®ç”Ÿæˆå›å¤</li>
                    </ul>
                    <p>é¡µé¢åŠ è½½åï¼ŒAIä¼šè‡ªåŠ¨åŸºäºæ‚¨ä¹‹å‰çš„å›ç­”ç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®ã€‚</p>
                </div>
            `,
            questions: [
                {
                    prompt: "ğŸ¤– AIä¸“å®¶åŸºäºæ‚¨çš„ä¿¡æ¯è‡ªåŠ¨ç”Ÿæˆçš„ä¸ªæ€§åŒ–å»ºè®®ï¼š",
                    name: "auto_advice"
                }
            ],
            hide_user_input: true,
            auto_generate: true,
            data_collector: collectPreviousData,
            base_url: "https://api.deepseek.com",
            api_key: "sk-7765bd6343924036b8bf4152cd5c3649",
            system_prompt: "åŸºäºç”¨æˆ·çš„èƒŒæ™¯ä¿¡æ¯å’ŒæŒ‘æˆ˜ï¼Œç”Ÿæˆ3-5æ¡å…·ä½“å¯è¡Œçš„è§£å†³å»ºè®®ï¼Œæ¯æ¡å»ºè®®åŒ…å«å…·ä½“çš„è¡ŒåŠ¨æ­¥éª¤ã€‚",
            max_tokens: 400,
            button_label: "ç»§ç»­é«˜çº§æŒ‰é’®æ¼”ç¤º"
        });

        // 5. åŠŸèƒ½3ï¼šé«˜çº§æŒ‰é’®æ§åˆ¶
        timeline.push({
            type: jsPsychSurveyTextLLM,
            preamble: `
                <h2>ğŸ® åŠŸèƒ½3ï¼šé«˜çº§æŒ‰é’®æ§åˆ¶</h2>
                <div class="instruction-box">
                    <p><strong>æ¼”ç¤ºåŠŸèƒ½ï¼š</strong>å¤šæŒ‰é’®äº¤äº’æ§åˆ¶</p>
                    <ul>
                        <li><strong>ç¡®è®¤ï¼š</strong>é”å®šAIå›å¤ï¼Œä¸å¯ä¿®æ”¹</li>
                        <li><strong>é‡æ–°ç”Ÿæˆï¼š</strong>ç”Ÿæˆæ–°çš„AIå›å¤</li>
                        <li><strong>ç¼–è¾‘ï¼š</strong>è§£é”å›å¤æ¡†ï¼Œå…è®¸æ‰‹åŠ¨ç¼–è¾‘</li>
                        <li><strong>è‡ªå®šä¹‰æŒ‰é’®ï¼š</strong>æ‰§è¡Œç‰¹æ®Šæ“ä½œ</li>
                    </ul>
                    <p>è¯·è¾“å…¥é—®é¢˜åç‚¹å‡»"Send to AI"ï¼Œç„¶åä½“éªŒå„ç§æŒ‰é’®åŠŸèƒ½ã€‚</p>
                </div>
            `,
            questions: [
                {
                    prompt: "è¯·æå‡ºä¸€ä¸ªæ‚¨å¸Œæœ›æ·±å…¥æ¢è®¨çš„é—®é¢˜ï¼š",
                    rows: 3,
                    required: true,
                    name: "deep_question"
                }
            ],
            enable_advanced_buttons: true,
            button_config: {
                show_confirm: true,
                show_regenerate: true,
                show_edit: true,
                confirm_locks: true,
                custom_buttons: [
                    {
                        label: "ğŸŒŸ åŠ å¼º",
                        action: "enhance",
                        callback: function(question_index, response_data, ai_response) {
                            if (ai_response) {
                                const current = ai_response.value;
                                ai_response.value = `âœ¨ å¢å¼ºç‰ˆå›å¤ï¼š\n\n${current}\n\nğŸ“š è¡¥å……è¯´æ˜ï¼šè¿™æ˜¯ä¸€ä¸ªé€šè¿‡è‡ªå®šä¹‰æŒ‰é’®å¢å¼ºçš„å›å¤ï¼Œå±•ç¤ºäº†æ’ä»¶çš„æ‰©å±•èƒ½åŠ›ã€‚`;
                            }
                        }
                    },
                    {
                        label: "ğŸ“‹ æ‘˜è¦",
                        action: "summarize",
                        callback: function(question_index, response_data, ai_response) {
                            if (ai_response) {
                                const current = ai_response.value;
                                const lines = current.split('\n').filter(line => line.trim());
                                const summary = lines.slice(0, 2).join(' ');
                                ai_response.value = `ğŸ“‹ æ‘˜è¦ç‰ˆæœ¬ï¼š${summary}`;
                            }
                        }
                    }
                ]
            },
            data_collector: collectPreviousData,
            base_url: "https://api.deepseek.com",
            api_key: "sk-7765bd6343924036b8bf4152cd5c3649",
            system_prompt: "ä½œä¸ºè¯¥é¢†åŸŸçš„èµ„æ·±ä¸“å®¶ï¼Œæä¾›æ·±å…¥ã€è¯¦ç»†çš„åˆ†æå’Œè§è§£ã€‚å›å¤åº”è¯¥æ—¢æœ‰ç†è®ºæ·±åº¦åˆæœ‰å®è·µä»·å€¼ã€‚",
            temperature: 0.8,
            max_tokens: 500,
            button_label: "å®Œæˆé«˜çº§åŠŸèƒ½æ¼”ç¤º"
        });

        // 6. ç»“æŸé¡µé¢
        timeline.push({
            type: jsPsychHtmlKeyboardResponse,
            stimulus: `
                <div style="text-align: center;">
                    <h2>ğŸ‰ é«˜çº§åŠŸèƒ½æ¼”ç¤ºå®Œæˆï¼</h2>
                    <div style="background: #f8f9fa; padding: 30px; border-radius: 12px; margin: 30px 0;">
                        <h3>ğŸ“‹ æ¼”ç¤ºåŠŸèƒ½æ€»ç»“</h3>
                        <div style="text-align: left; display: inline-block;">
                            <p>âœ… <strong>æ•°æ®æ”¶é›†å™¨ï¼š</strong>è‡ªåŠ¨æ”¶é›†å¹¶ä¼ é€’ä¸Šä¸‹æ–‡æ•°æ®ç»™AI</p>
                            <p>âœ… <strong>éšè—è¾“å…¥æ¨¡å¼ï¼š</strong>çº¯AIè¾“å‡ºå±•ç¤ºï¼Œé€‚åˆç»“æœå‘ˆç°</p>
                            <p>âœ… <strong>è‡ªåŠ¨ç”Ÿæˆï¼š</strong>é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è§¦å‘AIç”Ÿæˆ</p>
                            <p>âœ… <strong>é«˜çº§æŒ‰é’®ï¼š</strong>ç¡®è®¤é”å®šã€é‡æ–°ç”Ÿæˆã€ç¼–è¾‘è§£é”ã€è‡ªå®šä¹‰æ“ä½œ</p>
                        </div>
                    </div>
                    <p style="color: #7f8c8d;">æŒ‰ä»»æ„é”®æŸ¥çœ‹å®Œæ•´çš„å®éªŒæ•°æ®</p>
                </div>
            `
        });

        // è¿è¡Œå®éªŒ
        jsPsych.run(timeline);
    </script>
</body>
</html>
